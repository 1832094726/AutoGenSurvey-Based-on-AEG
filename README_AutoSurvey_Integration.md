# AutoSurvey集成功能

## 📋 项目概述

本项目实现了与AutoSurvey系统的深度集成，基于任务实体关系数据生成具有算法脉络关系的学术综述。系统能够自动提取算法演进关系，构建技术发展图谱，并生成高质量的综述文档。

## ✨ 核心功能

### 🎯 任务选择和数据提取
- **智能任务选择**: 支持从多个任务中选择和组合数据
- **实体关系提取**: 自动提取算法、数据集、指标等实体及其关系
- **数据质量评估**: 评估提取数据的完整性和可靠性

### 🌳 算法脉络分析
- **演进图谱构建**: 基于实体关系构建算法演进网络
- **关键节点识别**: 识别里程碑算法、突破性技术、影响力节点
- **发展路径分析**: 分析技术发展路径、分支点和融合点
- **时间线生成**: 构建技术发展的时间轴和阶段划分

### 🤖 AutoSurvey集成
- **无缝对接**: 与AutoSurvey系统的API深度集成
- **异步处理**: 支持长时间运行的综述生成任务
- **状态监控**: 实时监控生成进度和状态
- **错误处理**: 完善的错误处理和重试机制

### 📝 综述生成引擎
- **模板化生成**: 支持多种综述模板和风格
- **内容增强**: 基于算法脉络分析增强综述内容
- **质量评估**: 自动评估综述质量和完整性
- **多格式输出**: 支持Markdown、HTML、PDF、Word等格式

### 💾 存储管理系统
- **版本控制**: 支持综述的版本管理和历史记录
- **多格式存储**: 自动生成多种格式的文件
- **检索功能**: 支持按主题、标签、时间等维度检索
- **导出功能**: 灵活的导出和分享功能

## 🏗️ 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   任务选择界面   │    │  实体关系提取器  │    │  数据格式转换器  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │            算法脉络分析引擎                      │
         │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
         │  │  图谱构建   │ │  节点识别   │ │  路径分析   │ │
         │  └─────────────┘ └─────────────┘ └─────────────┘ │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │            AutoSurvey连接器                     │
         │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
         │  │  API调用    │ │  异步处理   │ │  状态监控   │ │
         │  └─────────────┘ └─────────────┘ └─────────────┘ │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │            综述生成引擎                          │
         │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
         │  │  内容生成   │ │  格式化     │ │  质量评估   │ │
         │  └─────────────┘ └─────────────┘ └─────────────┘ │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │            存储管理系统                          │
         │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
         │  │  版本管理   │ │  文件存储   │ │  检索导出   │ │
         │  └─────────────┘ └─────────────┘ └─────────────┘ │
         └─────────────────────────────────────────────────┘
```

## 🚀 快速开始

### 1. 环境验证
```bash
# 运行环境验证脚本
python scripts/validate_autosurvey_setup.py
```

### 2. 功能测试
```bash
# 运行端到端测试
python scripts/test_autosurvey_integration.py
```

### 3. 启动服务
```bash
# 启动Flask应用
python run.py
```

### 4. 访问界面
打开浏览器访问: `http://localhost:5000/autosurvey`

## 📖 使用指南

### 基本流程

1. **选择任务**
   - 在任务选择页面浏览可用任务
   - 支持按主题、状态、时间等筛选
   - 可选择单个或多个任务进行组合

2. **配置参数**
   - 设置综述主题和描述
   - 选择生成模板和风格
   - 配置输出格式和详细程度

3. **生成综述**
   - 系统自动提取实体关系数据
   - 构建算法演进图谱
   - 调用AutoSurvey生成基础内容
   - 基于脉络分析增强内容

4. **查看结果**
   - 实时监控生成进度
   - 查看综述内容和质量评估
   - 下载多种格式的文件

### API使用

```python
from app.modules.autosurvey_integration import AutoSurveyConnector, SurveyGenerationRequest

# 创建连接器
config = AutoSurveyConfig()
connector = AutoSurveyConnector(config)

# 创建生成请求
request = SurveyGenerationRequest(
    topic="深度学习在自然语言处理中的应用",
    task_data=task_data,
    parameters={"model": "gpt-4o-2024-05-13"}
)

# 生成综述
async with connector:
    result = await connector.generate_survey(request)
```

## 🔧 配置说明

### AutoSurvey配置
```python
class AutoSurveyConfig:
    api_key: str = "your-api-key"
    api_url: str = "https://api.openai.com/v1/chat/completions"
    model: str = "gpt-4o-2024-05-13"
    timeout: int = 300
    max_retries: int = 3
```

### 存储配置
```python
# 存储根目录
STORAGE_ROOT = "./survey_storage"

# 支持的输出格式
SUPPORTED_FORMATS = ["markdown", "html", "latex", "pdf", "word"]
```

## 📊 数据格式

### 输入数据格式
```json
{
  "task_id": "task_001",
  "entities": [
    {
      "entity_id": "bert_2018",
      "entity_type": "Algorithm",
      "name": "BERT",
      "year": 2018,
      "authors": ["Jacob Devlin", "Ming-Wei Chang"],
      "description": "双向编码器表示的Transformer模型"
    }
  ],
  "relations": [
    {
      "from_entity": "transformer_2017",
      "to_entity": "bert_2018",
      "relation_type": "基础架构",
      "confidence": 0.95
    }
  ]
}
```

### 输出数据格式
```json
{
  "survey_id": "survey_001",
  "topic": "自然语言处理中的预训练模型",
  "content": "# 综述内容...",
  "algorithm_lineage": {
    "key_nodes": [...],
    "development_paths": [...],
    "analysis_summary": "..."
  },
  "quality_metrics": {
    "completeness": 0.85,
    "coherence": 0.90,
    "overall": 0.87
  }
}
```

## 🧪 测试

### 单元测试
```bash
# 运行所有测试
pytest tests/test_autosurvey_integration.py -v

# 运行特定测试
pytest tests/test_autosurvey_integration.py::TestTaskSelector -v
```

### 集成测试
```bash
# 端到端测试
python scripts/test_autosurvey_integration.py
```

## 📈 性能优化

### 缓存策略
- 实体关系数据缓存
- 算法脉络分析结果缓存
- AutoSurvey API响应缓存

### 异步处理
- 长时间运行任务的异步处理
- 并发任务管理
- 资源监控和限制

### 数据库优化
- 索引优化
- 查询优化
- 连接池管理

## 🔒 安全考虑

### API安全
- API密钥安全存储
- 请求频率限制
- 错误信息脱敏

### 数据安全
- 敏感数据加密
- 访问权限控制
- 审计日志记录

## 🐛 故障排除

### 常见问题

1. **AutoSurvey连接失败**
   - 检查API密钥配置
   - 验证网络连接
   - 查看API限制状态

2. **数据提取错误**
   - 检查数据库连接
   - 验证任务ID有效性
   - 查看数据完整性

3. **生成质量不佳**
   - 增加输入数据量
   - 调整生成参数
   - 检查模板配置

### 日志分析
```bash
# 查看应用日志
tail -f logs/autosurvey_integration.log

# 查看错误日志
grep ERROR logs/autosurvey_integration.log
```

## 🤝 贡献指南

1. Fork项目仓库
2. 创建功能分支
3. 提交代码更改
4. 运行测试确保通过
5. 提交Pull Request

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 📞 支持

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件
- 参与讨论

---

*最后更新: 2024年1月*
